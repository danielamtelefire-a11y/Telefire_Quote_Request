<!doctype html>
<html lang="he" dir="rtl">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Telefire â€“ ×‘×§×©×ª ×”×¦×¢×ª ××—×™×¨</title>
  <style>
    :root{--brand-red:#d62828;--bg:#f7f7f8;--card:#fff;--ink:#0f172a;--muted:#6b7280;--border:#e5e7eb;--shadow:0 8px 24px rgba(0,0,0,.08)}
    html,body{height:100%;-webkit-text-size-adjust:100%}
    body{margin:0;background:var(--bg);color:var(--ink);font-family:Heebo,system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial}
    body::before{content:"";position:fixed;inset:0;background:url('background.png') center/cover no-repeat;opacity:.07;pointer-events:none;z-index:0}
    .container{position:relative;z-index:1;max-width:1024px;margin:20px auto;padding:0 16px}
    header{display:flex;align-items:center;justify-content:space-between;gap:16px;background:rgba(255,255,255,.9);backdrop-filter:blur(6px);border:1px solid var(--border);border-radius:16px;padding:12px 16px;box-shadow:var(--shadow)}
    .brand{display:flex;align-items:center;gap:12px}
    .brand img{height:44px;width:auto;object-fit:contain}
    .title{font-weight:800;letter-spacing:.2px}
    .badge{font-weight:700;color:#fff;background:var(--brand-red);padding:6px 10px;border-radius:999px;font-size:.9rem}
    .card{margin-top:14px;background:var(--card);border:1px solid var(--border);border-radius:18px;padding:18px;box-shadow:var(--shadow)}
    h1{font-size:1.35rem;margin:0 0 8px} h2{font-size:1.05rem;margin:20px 0 10px;color:var(--brand-red)}
    label{display:block;font-weight:600;margin:8px 0 6px}
    input,select,textarea,button{width:100%;box-sizing:border-box;padding:12px 14px;border:1px solid var(--border);border-radius:12px;font-size:16px;background:#fff}
    textarea{min-height:96px;resize:vertical}
    .grid{display:grid;grid-template-columns:repeat(12,1fr);gap:12px}
    .col-12{grid-column:span 12}.col-6{grid-column:span 6}.col-4{grid-column:span 4}.col-3{grid-column:span 3}
    @media (max-width:768px){.col-6,.col-4,.col-3{grid-column:span 12}h1{font-size:1.2rem}h2{font-size:1rem;margin-top:16px}}
    .checkboxes{display:flex;flex-wrap:wrap;gap:10px}
    .chip{display:inline-flex;align-items:center;gap:6px;padding:6px 10px;border:1px solid var(--border);border-radius:999px;background:#fff;cursor:pointer}
    .muted{color:var(--muted);font-size:.92rem}
    .actions{display:flex;gap:10px;margin-top:16px}
    .actions button{cursor:pointer} .primary{background:var(--brand-red);color:#fff} .ghost{background:#f1f2f5}
    table{width:100%;border-collapse:collapse;background:#fff} th,td{border:1px solid var(--border);padding:8px 10px;text-align:right} th{background:#f8fafc}
    .required::after{content:" *";color:var(--brand-red)} .footer{margin-top:14px;font-size:.85rem;color:var(--muted)}
    
    /* ×ª××•× ×•×ª */
    .photo-section{margin:12px 0;padding:12px;background:#f9fafb;border:1px solid var(--border);border-radius:12px}
    .photo-section label{display:flex;align-items:center;gap:8px;cursor:pointer;margin:0}
    .photo-section input[type="file"]{display:none}
    .photo-btn{display:inline-flex;align-items:center;gap:8px;padding:8px 14px;background:#fff;border:1px solid var(--border);border-radius:8px;cursor:pointer;transition:all .2s}
    .photo-btn:hover{border-color:var(--brand-red);box-shadow:0 2px 8px rgba(214,40,40,.1)}
    .photo-icon{font-size:1.2rem}
    .photo-preview{display:flex;gap:8px;margin-top:8px;flex-wrap:wrap}
    .photo-thumb{position:relative;width:80px;height:80px;border-radius:8px;overflow:hidden;border:1px solid var(--border)}
    .photo-thumb img{width:100%;height:100%;object-fit:cover}
    .photo-remove{position:absolute;top:2px;right:2px;background:rgba(214,40,40,.9);color:#fff;border:0;border-radius:4px;width:20px;height:20px;cursor:pointer;font-size:12px;line-height:1;padding:0}
    .photo-info{font-size:.85rem;color:var(--muted);margin-top:4px}
    
    @media (max-width:768px){
      table.responsive{border:0}
      table.responsive thead{display:none}
      table.responsive,table.responsive tbody,table.responsive tr,table.responsive td{display:block;width:100%}
      table.responsive tr{background:#fff;border:1px solid var(--border);border-radius:12px;padding:8px 10px;margin-bottom:10px}
      table.responsive td{border:0;padding:8px 0;display:flex;gap:8px;justify-content:space-between;align-items:flex-start}
      table.responsive td::before{content:attr(data-label);font-weight:700;color:#444}
      .actions{flex-direction:column}.actions button{width:100%}
    }
    .yn{display:flex;gap:8px;flex-wrap:wrap}
    .yn input{display:none}
    .yn label{padding:8px 12px;border:1px solid var(--border);border-radius:999px;cursor:pointer;background:#fff}
    .yn input:checked+label{border-color:var(--brand-red);box-shadow:0 0 0 2px rgba(214,40,40,.15)}
    .yn label::before{content:"";display:inline-block;width:1em;height:1em;margin-left:6px;border:1px solid #cbd5e1;border-radius:4px;vertical-align:-2px}
    .yn input:checked+label::before{content:"âœ”";display:inline-grid;place-items:center;border-color:var(--brand-red);color:#fff;background:var(--brand-red)}
    .board{border:1px solid var(--border);border-radius:14px;padding:12px;margin:10px 0;background:#fff}
    .board .board-head{display:flex;align-items:center;gap:8px;justify-content:space-between;margin-bottom:8px}
    .board .del{background:#f1f2f5}
    
    /* Loading overlay */
    .loading-overlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,.7);z-index:9999;justify-content:center;align-items:center;flex-direction:column;gap:16px}
    .loading-overlay.active{display:flex}
    .spinner{width:50px;height:50px;border:4px solid rgba(255,255,255,.3);border-top-color:#fff;border-radius:50%;animation:spin 1s linear infinite}
    @keyframes spin{to{transform:rotate(360deg)}}
    .loading-text{color:#fff;font-size:1.1rem;font-weight:600}
  </style>
</head>
<body>
  <div class="loading-overlay" id="loadingOverlay">
    <div class="spinner"></div>
    <div class="loading-text">××“×—×¡ ×•×©×•×œ×— ×ª××•× ×•×ª...</div>
  </div>

  <div class="container">
    <header>
      <div class="brand">
        <img src="logo.png" alt="Telefire logo" onerror="this.style.display='none'">
        <div class="title">Telefire</div>
      </div>
      <div class="badge">×‘×§×©×ª ×”×¦×¢×ª ××—×™×¨</div>
    </header>

    <div class="card">
      <form id="rfqForm" action="https://hook.eu2.make.com/qeec8sdrvoxa932ipvr8bm7tv41rlp8n" method="POST" enctype="multipart/form-data">
        <h1>×¤×¨×˜×™ ×˜×•×¤×¡</h1>

        <h2>×¤×¨×˜×™ ×”×œ×§×•×—</h2>
        <div class="grid">
          <div class="col-3"><label class="required">×©× ×”×˜×›× ××™</label><input name="×©× ×”××‘×§×©" required></div>
          <div class="col-3"><label class="required">×©× ×”×œ×§×•×—</label><input name="×©× ×”×œ×§×•×—" required></div>
          <div class="col-3">
            <label>×¡×•×’ ×”×¦×¢×”</label>
            <select name="×¡×•×’ ×”×¦×¢×”">
              <option value="">×‘×—×¨</option>
              <option>××–×¨×—×™</option>
              <option>×‘×˜×—×•× ×™</option>
            </select>
          </div>
          <div class="col-3"><label>××¡×¤×¨ ×¨×›×–×ª</label><input name="××¡×¤×¨ ×¨×›×–×ª"></div>
          <div class="col-3"><label>×©× ×‘×¡×™×¡</label><input name="×©× ××ª×¨"></div>

          <div class="col-6"><label>××§×•× ×‘××ª×¨</label><input name="××§×•× ×‘××ª×¨"></div>
          <div class="col-6"><label>××™×© ×§×©×¨ ×œ×§×¨×™××”</label><input name="××™×© ×§×©×¨ ×œ×§×¨×™××”"></div>
          <div class="col-6"><label>×›×ª×•×‘×ª ×œ×§×¨×™××”</label><input name="×›×ª×•×‘×ª ×œ×§×¨×™××”"></div>

          <div class="col-12"><label>××”×•×ª ×”×¢×‘×•×“×”</label><textarea name="××”×•×ª ×”×¢×‘×•×“×”"></textarea></div>
        </div>

        <h2>×¤×¨×˜×™× ×‘×¨×›×–×ª</h2>
        <div class="grid">
          <div class="col-3"><label>×¤× ×œ</label><input name="×¤× ×œ"></div>
          <div class="col-3"><label>×œ×•×œ××”</label><input name="×œ×•×œ××”"></div>
          <div class="col-3"><label>×›××•×ª ×›×ª×•×‘×•×ª × ×“×¨×©×•×ª</label><input type="number" id="reqAddr" name="×›××•×ª ×›×ª×•×‘×•×ª × ×“×¨×©×•×ª" min="0"></div>
          <div class="col-3"><label>×›××•×ª ×›×ª×•×‘×•×ª ×¤× ×•×™×•×ª ×‘×œ×•×œ××”</label><input type="number" id="freeAddr" name="×›××•×ª ×›×ª×•×‘×•×ª ×¤× ×•×™×•×ª ×‘×œ×•×œ××”" min="0"></div>
          <div class="col-12"><div id="addrWarn" class="muted" style="color:#b91c1c;display:none">×›××•×ª ×›×ª×•×‘×•×ª × ×“×¨×©×•×ª ×œ× ×™×›×•×œ×” ×œ×”×™×•×ª ×’×“×•×œ×” ××›××•×ª ×”×›×ª×•×‘×•×ª ×”×¤× ×•×™×•×ª ×‘×œ×•×œ××”.</div></div>
        </div>

        <h2>×ª×©×ª×™×ª</h2>
        <div class="grid">
          <div class="col-6">
            <label>×”×× × ×“×¨×©×ª ×”×›× ×ª ×ª×©×ª×™×ª</label>
            <select name="×”×× × ×“×¨×©×ª ×”×›× ×ª ×ª×©×ª×™×ª">
              <option value="">×‘×—×¨</option><option>×›×Ÿ</option><option>×œ×</option>
              <option>×ª×©×ª×™×ª ×§×™×™××ª ××• ×ª×•×›×Ÿ ×¢×´×™ ×”×œ×§×•×—</option><option>×§×™×™××ª ×ª×©×ª×™×ª ×—×œ×§×™×ª ×™×© ×œ×”×©×œ×™×</option>
            </select>
          </div>
          <div class="col-6"><label>××•×¨×š ×”×ª×©×ª×™×ª ×©× ×“×¨×© ×œ×”×›×™×Ÿ (××³)</label><input type="number" name="××•×¨×š ×”×ª×©×ª×™×ª" min="0" step="0.1"></div>
          <div class="col-6">
            <label>×¡×•×’ ×›×‘×œ</label>
            <select name="×¡×•×’ ×›×‘×œ">
              <option value="">×‘×—×¨</option><option>NYY</option><option>2 ×’×™×“</option><option>4 ×’×™×“</option><option>×¨×‘-×’×™×“×™</option>
            </select>
          </div>
          <div class="col-12">
            <label>××¢×‘×™×¨ ×›×‘×œ</label>
            <div class="checkboxes">
              <label class="chip"><input type="checkbox" name="××¢×‘×™×¨ ×›×‘×œ[]" value="××¨×™×›×£"> ××¨×™×›×£</label>
              <label class="chip"><input type="checkbox" name="××¢×‘×™×¨ ×›×‘×œ[]" value="××¨×™×¨×•×Ÿ"> ××¨×™×¨×•×Ÿ</label>
              <label class="chip"><input type="checkbox" name="××¢×‘×™×¨ ×›×‘×œ[]" value="×ª×¢×œ×ª ××¦×‘×¢"> ×ª×¢×œ×ª ××¦×‘×¢</label>
              <label class="chip"><input type="checkbox" name="××¢×‘×™×¨ ×›×‘×œ[]" value="×ª×¢×œ×” ×›×¤×•×œ×”"> ×ª×¢×œ×” ×›×¤×•×œ×”</label>
            </div>
          </div>

          <div class="col-3">
            <label>×§×™×™× V24</label>
            <div class="yn">
              <input type="radio" id="v24y" name="×§×™×™× V24" value="×›×Ÿ"><label for="v24y">×›×Ÿ</label>
              <input type="radio" id="v24n" name="×§×™×™× V24" value="×œ×"><label for="v24n">×œ×</label>
            </div>
          </div>
          <div class="col-3">
            <label>× ×“×¨×© ×”×•×¡×¤×ª ×¡×¤×§</label>
            <div class="yn">
              <input type="radio" id="psuy" name="× ×“×¨×© ×”×•×¡×¤×ª ×¡×¤×§" value="×›×Ÿ"><label for="psuy">×›×Ÿ</label>
              <input type="radio" id="psun" name="× ×“×¨×© ×”×•×¡×¤×ª ×¡×¤×§" value="×œ×"><label for="psun">×œ×</label>
            </div>
          </div>
        </div>



        <h2>× ×ª×•× ×™ ×œ×•×— ×”×—×©××œ</h2>
        <div id="boards"></div>
        <div class="actions"><button type="button" class="ghost" id="addBoardBtn">×”×•×¡×£ ×œ×•×—</button></div>

        <h2>× ×ª×•× ×™ ×›×™×‘×•×™ ×‘×—×“×¨ ××• ×—×œ×œ</h2>
        <div class="board">
          <div class="muted" style="margin-bottom:6px">××™×“×•×ª</div>
          <table class="responsive" aria-label="× ×ª×•× ×™ ×›×™×‘×•×™ â€“ ××™×“×•×ª">
            <thead><tr><th>×¨×•×—×‘ (×')</th><th>×’×•×‘×” (×')</th><th>××•×¨×š (×')</th></tr></thead>
            <tbody>
              <tr>
                <td data-label="×¨×•×—×‘ (××´×)"><input type="number" name="×›×™×‘×•×™_×¨×•×—×‘" min="0"></td>
                <td data-label="×’×•×‘×” (××´×)"><input type="number" name="×›×™×‘×•×™_×’×•×‘×”" min="0"></td>
                <td data-label="×¢×•××§ (××´×)"><input type="number" name="×›×™×‘×•×™_×¢×•××§" min="0"></td>
              </tr>
            </tbody>
          </table>
          <div class="grid">
            <div class="col-12"><label>×”×¢×¨×•×ª</label><textarea name="×›×™×‘×•×™_×”×¢×¨×•×ª"></textarea></div>
          </div>
        </div>



        <h2>××‘×™×–×¨×™× × ×“×¨×©×™× ×œ×”×¦×¢×”</h2>
        <p class="muted">××‘×™×–×¨, ×›××•×ª, ×”×¢×¨×”.</p>
        <table id="itemsTable" class="responsive" aria-label="××‘×™×–×¨×™×">
          <thead><tr><th>××‘×™×–×¨</th><th>×›××•×ª</th><th>×”×¢×¨×”</th><th>××—×™×§×”</th></tr></thead>
          <tbody></tbody>
        </table>
        <div class="actions"><button type="button" class="ghost" onclick="addItemRow()">×”×•×¡×£ ×©×•×¨×”</button></div>



        <h2>×ª× ××™ ×©×˜×—</h2>
        <div class="grid">
          <div class="col-4"><label>×’×•×‘×” ×”×”×ª×§× ×” (××³)</label><input type="number" name="×’×•×‘×” ×”×ª×§× ×”" min="0" step="0.1"></div>
          <div class="col-4">
            <label>×”×ª×§× ×” ×‘×’×•×‘×”</label>
            <div class="yn">
              <input type="radio" id="highy" name="×”×ª×§× ×” ×‘×’×•×‘×”" value="×›×Ÿ"><label for="highy">×›×Ÿ</label>
              <input type="radio" id="highn" name="×”×ª×§× ×” ×‘×’×•×‘×”" value="×œ×"><label for="highn">×œ×</label>
            </div>
          </div>
          <div class="col-4">
            <label>×‘××ª ×”×¨××”</label>
            <div class="yn">
              <input type="radio" id="platfy" name="×‘××ª ×”×¨××”" value="×›×Ÿ"><label for="platfy">×›×Ÿ</label>
              <input type="radio" id="platfn" name="×‘××ª ×”×¨××”" value="×œ×"><label for="platfn">×œ×</label>
            </div>
          </div>
          <div class="col-12"><label>×ª× ××™ ×©×˜×— × ×•×¡×¤×™×</label><textarea name="×ª× ××™ ×©×˜×— × ×•×¡×¤×™×"></textarea></div>
        </div>



        <h2>×”×¢×¨×•×ª ×›×œ×œ×™×•×ª</h2>
        <textarea name="×”×¢×¨×•×ª ×›×œ×œ×™×•×ª"></textarea>

        <!-- ×ª××•× ×•×ª -->
        <div class="photo-section">
          <label for="photos" class="photo-btn">
            <span class="photo-icon">ğŸ“·</span>
            <span>×”×•×¡×£ ×ª××•× ×”</span>
            <input type="file" id="photos" accept="image/*" name="×ª××•× ×”">
          </label>
          <div class="photo-info">×’×•×“×œ ××§×¡×™××œ×™: 5MB | ×ª××•× ×” ×ª×™×“×—×¡ ××•×˜×•××˜×™×ª ×× × ×“×¨×©</div>
        </div>

        <div class="actions">
          <button type="submit" class="primary">×©×œ×—</button>
          <button type="reset" class="ghost">× ×§×” ×˜×•×¤×¡</button>
        </div>

        <p class="footer">×”×¢×œ×” `logo.png` ×•Ö¾`background.png` ×œ×©×•×¨×© ×”×¨×™×¤×• ×œ×œ×•×’×• ×•×¨×§×¢.</p>
      </form>
    </div>
  </div>

  <script>
    /* ××¢×¨×š ×œ×©××™×¨×ª ×›×œ ×”×ª××•× ×•×ª */
    const allPhotos = {};

    /* ×“×—×™×¡×ª ×ª××•× ×” */
    async function compressImage(file, maxSizeMB = 1.5, maxWidth = 2000) {
      return new Promise((resolve) => {
        const reader = new FileReader();
        reader.onload = (e) => {
          const img = new Image();
          img.src = e.target.result;
          img.onload = () => {
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            
            let width = img.width;
            let height = img.height;
            
            if (width > maxWidth) {
              height = (maxWidth / width) * height;
              width = maxWidth;
            }
            
            canvas.width = width;
            canvas.height = height;
            ctx.drawImage(img, 0, 0, width, height);
            
            canvas.toBlob((blob) => {
              if (blob.size > maxSizeMB * 1024 * 1024) {
                const quality = Math.max(0.5, (maxSizeMB * 1024 * 1024) / blob.size * 0.85);
                canvas.toBlob((smallerBlob) => {
                  resolve(new File([smallerBlob], file.name, { type: 'image/jpeg' }));
                }, 'image/jpeg', quality);
              } else {
                resolve(new File([blob], file.name, { type: 'image/jpeg' }));
              }
            }, 'image/jpeg', 0.85);
          };
        };
        reader.readAsDataURL(file);
      });
    }

    /* ×˜×™×¤×•×œ ×‘×”×¢×œ××ª ×ª××•× ×•×ª */
    document.querySelectorAll('.photo-input').forEach(input => {
      input.addEventListener('change', async function(e) {
        const category = this.dataset.category;
        const maxFiles = parseInt(this.dataset.max);
        const previewId = this.id.replace('photos-', 'preview-');
        const previewDiv = document.getElementById(previewId);
        
        let files = Array.from(e.target.files);
        
        if (files.length > maxFiles) {
          alert(`× ×™×ª×Ÿ ×œ×”×¢×œ×•×ª ×¢×“ ${maxFiles} ×ª××•× ×•×ª ×‘×§×˜×’×•×¨×™×” ×–×•`);
          files = files.slice(0, maxFiles);
        }
        
        if (!allPhotos[category]) allPhotos[category] = [];
        
        if (allPhotos[category].length + files.length > maxFiles) {
          alert(`× ×™×ª×Ÿ ×œ×”×¢×œ×•×ª ×¢×“ ${maxFiles} ×ª××•× ×•×ª ×‘×§×˜×’×•×¨×™×” ×–×•`);
          files = files.slice(0, maxFiles - allPhotos[category].length);
        }
        
        for (let file of files) {
          const compressed = await compressImage(file);
          const index = allPhotos[category].length + 1;
          const newName = `${category}_${index}.jpg`;
          
          const renamedFile = new File([compressed], newName, { type: 'image/jpeg' });
          allPhotos[category].push(renamedFile);
          
          const thumb = document.createElement('div');
          thumb.className = 'photo-thumb';
          
          const img = document.createElement('img');
          img.src = URL.createObjectURL(compressed);
          
          const removeBtn = document.createElement('button');
          removeBtn.className = 'photo-remove';
          removeBtn.textContent = 'Ã—';
          removeBtn.type = 'button';
          removeBtn.onclick = () => {
            const idx = allPhotos[category].indexOf(renamedFile);
            if (idx > -1) allPhotos[category].splice(idx, 1);
            thumb.remove();
          };
          
          thumb.appendChild(img);
          thumb.appendChild(removeBtn);
          previewDiv.appendChild(thumb);
        }
        
        e.target.value = '';
      });
    });

    /* ×œ×•×—×•×ª ×—×©××œ ×¢× ×ª××•× ×•×ª */
    let boardIdx = 0;
    function ynGroup(name, idBase){
      const wrap = document.createElement('div');
      wrap.className = 'yn';
      const y = document.createElement('input');
      y.type = 'radio';
      y.id = idBase + 'y';
      y.name = name;
      y.value = '×›×Ÿ';
      const yl = document.createElement('label');
      yl.htmlFor = y.id;
      yl.textContent = '×›×Ÿ';
      const n = document.createElement('input');
      n.type = 'radio';
      n.id = idBase + 'n';
      n.name = name;
      n.value = '×œ×';
      const nl = document.createElement('label');
      nl.htmlFor = n.id;
      nl.textContent = '×œ×';
      wrap.append(y, yl, n, nl);
      return wrap;
    }

    function addBoard(){
      boardIdx++;
      const wrap = document.createElement('section');
      wrap.className = 'board';
      wrap.innerHTML = `
        <div class="board-head">
          <strong>×œ×•×— ${boardIdx}</strong>
          <button type="button" class="del" aria-label="××—×™×§×ª ×œ×•×—">××—×§ ×œ×•×—</button>
        </div>

        <div class="grid">
          <div class="col-6"><label>×©× ×”×œ×•×—</label><input name="×œ×•×—_${boardIdx}_×©×"></div>
        </div>

        <div class="muted" style="margin:8px 0 6px">×˜×‘×œ×” 2 â€“ ××™×“×•×ª</div>
        <table class="responsive" aria-label="×˜×‘×œ×” 2 â€“ ××™×“×•×ª">
          <thead><tr><th>×¨×•×—×‘ (××´×)</th><th>×’×•×‘×” (××´×)</th><th>×¢×•××§ (××´×)</th></tr></thead>
          <tbody>
            <tr>
              <td data-label="×¨×•×—×‘ (××´×)"><input type="number" name="×œ×•×—_${boardIdx}_×¨×•×—×‘" min="0"></td>
              <td data-label="×’×•×‘×” (××´×)"><input type="number" name="×œ×•×—_${boardIdx}_×’×•×‘×”" min="0"></td>
              <td data-label="×¢×•××§ (××´×)"><input type="number" name="×œ×•×—_${boardIdx}_×¢×•××§" min="0"></td>
            </tr>
          </tbody>
        </table>

        <div class="grid" style="margin-top:8px">
          <div class="col-3"><label>××—×•×¨×¥</label><div id="g_${boardIdx}_groove" class="yn"></div></div>
          <div class="col-3"><label>××˜×•×</label><div id="g_${boardIdx}_seal" class="yn"></div></div>
          <div class="col-3"><label>××—×™×¦×•×ª ×‘× ×¤×¨×“</label><div id="g_${boardIdx}_parts_sep" class="yn"></div></div>
          <div class="col-3"><label>××—×™×¦×•×ª ×¦××•×“×•×ª ××—×ª ×œ×©× ×™×™×”</label><div id="g_${boardIdx}_parts_adj" class="yn"></div></div>

          <div class="col-3"><label>××¡×¤×¨ × ×—×™×¨×™×</label><input type="number" name="×œ×•×—_${boardIdx}_× ×—×™×¨×™×" min="0"></div>

          <div class="col-6"><label>××™×§×•××™ ××—×™×¦×•×ª</label><input name="×œ×•×—_${boardIdx}_××™×§×•××™_××—×™×¦×•×ª"></div>
          <div class="col-12"><label>×”×¢×¨×•×ª</label><input name="×œ×•×—_${boardIdx}_×”×¢×¨×•×ª"></div>
        </div>

        <div class="photo-section">
          <label for="photos-board-${boardIdx}" class="photo-btn">
            <span class="photo-icon">ğŸ“·</span>
            <span>×”×•×¡×£ ×ª××•× ×•×ª ×œ×•×— ${boardIdx} (×¢×“ 2)</span>
            <input type="file" id="photos-board-${boardIdx}" accept="image/*" multiple data-category="×œ×•×—_${boardIdx}" data-max="2" class="photo-input">
          </label>
          <div class="photo-preview" id="preview-board-${boardIdx}"></div>
          <div class="photo-info">×’×•×“×œ ××§×¡×™××œ×™: 1.5MB ×œ×ª××•× ×” | ×ª××•× ×•×ª ×™×“×—×¡×• ××•×˜×•××˜×™×ª</div>
        </div>
      `;
      
      wrap.querySelector('#g_' + boardIdx + '_groove').appendChild(ynGroup('×œ×•×—_' + boardIdx + '_××—×•×¨×¥', 'groove' + boardIdx));
      wrap.querySelector('#g_' + boardIdx + '_seal').appendChild(ynGroup('×œ×•×—_' + boardIdx + '_××˜×•×', 'seal' + boardIdx));
      wrap.querySelector('#g_' + boardIdx + '_parts_sep').appendChild(ynGroup('×œ×•×—_' + boardIdx + '_××—×™×¦×•×ª_×‘× ×¤×¨×“', 'partssep' + boardIdx));
      wrap.querySelector('#g_' + boardIdx + '_parts_adj').appendChild(ynGroup('×œ×•×—_' + boardIdx + '_××—×™×¦×•×ª_×¦××•×“×•×ª', 'partsadj' + boardIdx));

      const photoInput = wrap.querySelector('.photo-input');
      photoInput.addEventListener('change', async function(e) {
        const category = this.dataset.category;
        const maxFiles = parseInt(this.dataset.max);
        const previewId = this.id.replace('photos-', 'preview-');
        const previewDiv = document.getElementById(previewId);
        
        let files = Array.from(e.target.files);
        
        if (files.length > maxFiles) {
          alert(`× ×™×ª×Ÿ ×œ×”×¢×œ×•×ª ×¢×“ ${maxFiles} ×ª××•× ×•×ª ×‘×§×˜×’×•×¨×™×” ×–×•`);
          files = files.slice(0, maxFiles);
        }
        
        if (!allPhotos[category]) allPhotos[category] = [];
        
        if (allPhotos[category].length + files.length > maxFiles) {
          alert(`× ×™×ª×Ÿ ×œ×”×¢×œ×•×ª ×¢×“ ${maxFiles} ×ª××•× ×•×ª ×‘×§×˜×’×•×¨×™×” ×–×•`);
          files = files.slice(0, maxFiles - allPhotos[category].length);
        }
        
        for (let file of files) {
          const compressed = await compressImage(file);
          const index = allPhotos[category].length + 1;
          const newName = `${category}_${index}.jpg`;
          
          const renamedFile = new File([compressed], newName, { type: 'image/jpeg' });
          allPhotos[category].push(renamedFile);
          
          const thumb = document.createElement('div');
          thumb.className = 'photo-thumb';
          
          const img = document.createElement('img');
          img.src = URL.createObjectURL(compressed);
          
          const removeBtn = document.createElement('button');
          removeBtn.className = 'photo-remove';
          removeBtn.textContent = 'Ã—';
          removeBtn.type = 'button';
          removeBtn.onclick = () => {
            const idx = allPhotos[category].indexOf(renamedFile);
            if (idx > -1) allPhotos[category].splice(idx, 1);
            thumb.remove();
          };
          
          thumb.appendChild(img);
          thumb.appendChild(removeBtn);
          previewDiv.appendChild(thumb);
        }
        
        e.target.value = '';
      });

      wrap.querySelector('.del').onclick = () => {
        delete allPhotos[`×œ×•×—_${boardIdx}`];
        wrap.remove();
      };
      
      document.getElementById('boards').appendChild(wrap);
    }

    document.getElementById('addBoardBtn').addEventListener('click', addBoard);

    /* ××‘×™×–×¨×™× */
    const ACCESSORIES = [
      "", "×’×œ××™", "×‘×¡×™×¡", "×”×’×‘×”×”", "×œ×—×¦×Ÿ ××“×•×", "×œ×—×¦×Ÿ ×¦×”×•×‘", "×œ×—×¦×Ÿ ××“×•× ××•×’×Ÿ ××™×",
      "×›×¨×˜×™×¡ 723", "×›×¨×˜×™×¡ 741", "×›×¨×˜×™×¡ 705", "×›×¨×˜×™×¡ 805", "×× ×•×¨×ª ×¡×™××•×Ÿ", "×§×•×¤×¡×ª ×›×¨×˜×™×¡×™×",
      "×§×•×¤×¡×ª ×—×™×‘×•×¨×™×", "×›×•×‘×¢ ×œ×’×œ××™ ×‘×œ×•×—", "FLAP", "×¦×•×¤×¨ ×—×™×¦×•× ×™", "×¦×•×¤×¨ ×¤× ×™××™",
      "×¨××§×•×œ ×©×§×•×¢", "×¨××§×•×œ ×™×¨×—", "×©×•×¤×¨", "×¤× ×œ ××©× ×”", "AKSA PRO", "××—×¨"
    ];

    function accessorySelect(name) {
      const sel = document.createElement('select');
      sel.name = name;
      for (const opt of ACCESSORIES) {
        const o = document.createElement('option');
        o.value = opt;
        o.textContent = opt;
        sel.appendChild(o);
      }
      return sel;
    }

    function addItemRow() {
      const tbody = document.querySelector('#itemsTable tbody');
      const tr = document.createElement('tr');
      const td1 = document.createElement('td');
      td1.setAttribute('data-label', '××‘×™×–×¨');
      td1.appendChild(accessorySelect('××‘×™×–×¨[]'));
      const td2 = document.createElement('td');
      td2.setAttribute('data-label', '×›××•×ª');
      const qty = document.createElement('input');
      qty.type = 'number';
      qty.min = '0';
      qty.name = '×›××•×ª[]';
      td2.appendChild(qty);
      const td3 = document.createElement('td');
      td3.setAttribute('data-label', '×”×¢×¨×”');
      const note = document.createElement('input');
      note.type = 'text';
      note.name = '×”×¢×¨×”[]';
      td3.appendChild(note);
      const td4 = document.createElement('td');
      td4.setAttribute('data-label', '××—×™×§×”');
      const del = document.createElement('button');
      del.type = 'button';
      del.textContent = '××—×™×§×”';
      del.onclick = () => tr.remove();
      td4.appendChild(del);
      tr.append(td1, td2, td3, td4);
      tbody.appendChild(tr);
    }

    /* ×•×œ×™×“×¦×™×” ×›×ª×•×‘×•×ª */
    const reqAddr = document.getElementById('reqAddr');
    const freeAddr = document.getElementById('freeAddr');
    const addrWarn = document.getElementById('addrWarn');

    function checkAddr() {
      const r = Number(reqAddr.value || 0), f = Number(freeAddr.value || 0);
      const bad = r > f && f > 0;
      addrWarn.style.display = bad ? 'block' : 'none';
      return !bad;
    }

    reqAddr.addEventListener('input', checkAddr);
    freeAddr.addEventListener('input', checkAddr);

    /* ×©×œ×™×—×ª ×˜×•×¤×¡ */
    document.getElementById('rfqForm').addEventListener('submit', async function(e) {
      e.preventDefault();
      
      const tech = this.querySelector('input[name="×©× ×”××‘×§×©"]');
      const client = this.querySelector('input[name="×©× ×”×œ×§×•×—"]');
      
      if (!tech.value.trim() || !client.value.trim()) {
        alert('×©× ×”×˜×›× ××™ ×•×©× ×”×œ×§×•×— ×”× ×©×“×•×ª ×—×•×‘×”.');
        return;
      }
      
      if (!checkAddr()) {
        alert('×›××•×ª ×›×ª×•×‘×•×ª × ×“×¨×©×•×ª ×œ× ×™×›×•×œ×” ×œ×”×™×•×ª ×’×“×•×œ×” ××›××•×ª ×”×›×ª×•×‘×•×ª ×”×¤× ×•×™×•×ª ×‘×œ×•×œ××”.');
        return;
      }
      
      const loadingOverlay = document.getElementById('loadingOverlay');
      if (loadingOverlay) {
        loadingOverlay.classList.add('active');
      }
      
      const formData = new FormData(this);
      
      // ×©×œ×™×—×ª ×ª××•× ×•×ª ×‘×¤×•×¨××˜ ×©Make ×™×›×•×œ ×œ×§×¨×•×
      let photoIndex = 0;
      for (const category in allPhotos) {
        for (const file of allPhotos[category]) {
          formData.append(`×ª××•× ×”_${photoIndex}`, file, file.name);
          photoIndex++;
        }
      }
      
      try {
        const response = await fetch(this.action, {
          method: 'POST',
          body: formData,
          mode: 'cors'
        });
        
        if (response.ok || response.redirected) {
          const result = await response.text();
          document.body.innerHTML = result;
        } else {
          const errorText = await response.text();
          console.error('Response error:', errorText);
          throw new Error('×©×’×™××” ×‘×©×œ×™×—×” - ' + response.status);
        }
      } catch (error) {
        alert('××™×¨×¢×” ×©×’×™××” ×‘×©×œ×™×—×ª ×”×˜×•×¤×¡. ×× × × ×¡×” ×©×•×‘.\n\n×¤×¨×˜×™×: ' + error.message);
        console.error('Submit error:', error);
      } finally {
        if (loadingOverlay) {
          loadingOverlay.classList.remove('active');
        }
      }
    });

    /* ×”×ª×—×œ×” */
    addBoard();
    addItemRow();
  </script>
</body>
</html>
